# JSæµè§ˆå™¨äº‹ä»¶å¾ªç¯æœºåˆ¶

### è¿›ç¨‹ä¸çº¿ç¨‹

* è¿›ç¨‹æ˜¯ç³»ç»Ÿåˆ†é…çš„ç‹¬ç«‹èµ„æº,æ˜¯cpuèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½,è¿›ç¨‹æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç»„æˆã€‚
* çº¿ç¨‹æ˜¯è¿›ç¨‹çš„æ‰§è¡Œæµï¼Œæ˜¯cpuè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼ŒåŒä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„èµ„æºã€‚

### æµè§ˆå™¨å†…æ ¸

* æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼Œæµè§ˆå™¨æ¯ä¸€ä¸ª tab æ ‡ç­¾éƒ½ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼ˆä¹Ÿä¸ä¸€å®šï¼Œå› ä¸ºå¤šä¸ªç©ºç™½ tab æ ‡ç­¾ä¼šåˆå¹¶æˆä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼Œæµè§ˆå™¨å†…æ ¸ï¼ˆæµè§ˆå™¨æ¸²æŸ“è¿›ç¨‹ï¼‰å±äºæµè§ˆå™¨å¤šè¿›ç¨‹ä¸­çš„ä¸€ç§ã€‚

* æµè§ˆå™¨å†…æ ¸æœ‰å¤šç§çº¿ç¨‹åœ¨å·¥ä½œã€‚
    * GUIæ¸²æŸ“çº¿ç¨‹:
        * è´Ÿè´£æ¸²æŸ“é¡µé¢ï¼Œè§£æ HTMLï¼ŒCSS æ„æˆ DOM æ ‘ç­‰ï¼Œå½“é¡µé¢é‡ç»˜æˆ–è€…ç”±äºæŸç§æ“ä½œå¼•èµ·å›æµéƒ½ä¼šè°ƒèµ·è¯¥çº¿ç¨‹ã€‚
        * å’Œ JS å¼•æ“çº¿ç¨‹æ˜¯äº’æ–¥çš„ï¼Œå½“ JS å¼•æ“çº¿ç¨‹åœ¨å·¥ä½œçš„æ—¶å€™ï¼ŒGUI æ¸²æŸ“çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼ŒGUI æ›´æ–°è¢«æ”¾å…¥åœ¨ JS ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“çº¿ç¨‹ç©ºé—²çš„æ—¶å€™ç»§ç»­æ‰§è¡Œã€‚

    * JSå¼•æ“çº¿ç¨‹
        * å•çº¿ç¨‹å·¥ä½œï¼Œè´Ÿè´£è§£æJavascriptè„šæœ¬
        * å’ŒGUIæ¸²æŸ“çº¿ç¨‹äº’æ–¥ï¼ŒJSè¿è¡Œè€—æ—¶è¿‡é•¿ä¼šé€ æˆé¡µé¢é˜»å¡

    * äº‹ä»¶è§¦å‘çº¿ç¨‹
        * å½“äº‹ä»¶ç¬¦åˆè§¦å‘æ¡ä»¶æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šæŠŠå¯¹åº”çš„äº‹ä»¶å›è°ƒå‡½æ•°æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…JSå¼•æ“å¤„ç†
    
    * å®šæ—¶å™¨è§¦å‘çº¿ç¨‹
        * æµè§ˆå™¨å®šæ—¶è®¡æ•°å™¨å¹¶ä¸æ˜¯ç”± JS å¼•æ“è®¡æ•°çš„ï¼Œé˜»å¡ä¼šå¯¼è‡´è®¡æ—¶ä¸å‡†ç¡®ã€‚
        * å¼€å¯å®šæ—¶å™¨è§¦å‘çº¿ç¨‹æ¥è®¡æ—¶å¹¶è§¦å‘è®¡æ—¶ï¼Œè®¡æ—¶å®Œæˆåä¼šè¢«æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“å¤„ç†ã€‚
    
    * HTTPè¯·æ±‚çº¿ç¨‹
        * HTTPè¯·æ±‚æ—¶ä¼šå¼€å¯ä¸€æ¡è¯·æ±‚çº¿ç¨‹ã€‚
        * è¯·æ±‚å®Œæˆæœ‰ç»“æœäº†ä¹‹åï¼Œå°†è¯·æ±‚çš„å›è°ƒå‡½æ•°æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾… JS å¼•æ“å¤„ç†ã€‚

#### JavaScript å¼•æ“æ˜¯å•çº¿ç¨‹

JavaScript å¼•æ“æ˜¯å•çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡åªèƒ½æ‰§è¡Œä¸€é¡¹ä»»åŠ¡ï¼Œå…¶ä»–ä»»åŠ¡éƒ½å¾—æŒ‰ç…§é¡ºåºæ’é˜Ÿç­‰å¾…è¢«æ‰§è¡Œï¼Œåªæœ‰å½“å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åæ‰ä¼šå¾€ä¸‹æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚

HTML5 ä¸­æå‡ºäº† Web-Worker APIï¼Œä¸»è¦æ˜¯ä¸ºäº†è§£å†³é¡µé¢é˜»å¡é—®é¢˜ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ”¹å˜ JavaScript æ˜¯å•çº¿ç¨‹çš„æœ¬è´¨ã€‚äº†è§£ [Web-Worker](https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API)ã€‚

#### Javascript äº‹ä»¶å¾ªç¯æœºåˆ¶

JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶åˆ†ä¸ºæµè§ˆå™¨å’Œ Node äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œä¸¤è€…çš„å®ç°æŠ€æœ¯ä¸ä¸€æ ·ï¼Œæµè§ˆå™¨ Event Loop æ˜¯ HTML ä¸­å®šä¹‰çš„è§„èŒƒï¼ŒNode Event Loop æ˜¯ç”± libuv åº“å®ç°ã€‚è¿™é‡Œä¸»è¦è®²çš„æ˜¯æµè§ˆå™¨éƒ¨åˆ†ã€‚

Javascriptæœ‰ä¸€ä¸ªmain threadä¸»çº¿ç¨‹ï¼Œå’Œcall stackè°ƒç”¨æ ˆ(æ‰§è¡Œæ ˆ)ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šè¢«æ”¾åˆ°è°ƒç”¨æ ˆç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚

* JSè°ƒç”¨æ ˆ

JSè°ƒç”¨æ ˆæ˜¯ä¸€ç§åè¿›å…ˆå‡ºçš„çš„æ•°æ®ç»“æ„ã€‚å½“å‡½æ•°è¢«è°ƒç”¨æ˜¯ï¼Œä¼šè¢«æ·»åŠ åˆ°æ ˆé¡¶ï¼Œæ‰§è¡Œå®Œæˆåå°±ä»æ ˆé¡¶ç§»å‡ºè¯¥å‡½æ•°ï¼Œç›´åˆ°æ ˆè¢«æ¸…ç©ºã€‚

*  åŒæ­¥ä»»åŠ¡ã€å¼‚æ­¥ä»»åŠ¡

JavaScript å•çº¿ç¨‹ä¸­çš„ä»»åŠ¡åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ã€‚åŒæ­¥ä»»åŠ¡ä¼šåœ¨è°ƒç”¨æ ˆä¸­æŒ‰ç…§é¡ºåºæ’é˜Ÿç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡åˆ™ä¼šåœ¨å¼‚æ­¥æœ‰äº†ç»“æœåå°†æ³¨å†Œçš„å›è°ƒå‡½æ•°æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—(æ¶ˆæ¯é˜Ÿåˆ—)ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯æ ˆå†…è¢«æ¸…ç©ºçš„æ—¶å€™ï¼Œè¢«è¯»å–åˆ°æ ˆä¸­ç­‰å¾…ä¸»çº¿ç¨‹æ‰§è¡Œã€‚ä»»åŠ¡é˜Ÿåˆ—æ˜¯å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ã€‚

* Event Loop

è°ƒç”¨æ ˆä¸­çš„åŒæ­¥ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆè¢«æ¸…ç©ºï¼Œ å°±ä»£è¡¨ä¸»çº¿ç¨‹ç©ºé—²äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±ä¼šå»ä»»åŠ¡é˜Ÿåˆ—ä¸­æŒ‰é¡ºåºæ”¾åˆ°æ ˆå†…æ‰§è¡Œï¼Œæ¯æ¬¡è¢«æ ˆè¢«æ¸…ç©ºï¼Œéƒ½ä¼šå»è¯»å–ä»»åŠ¡é˜Ÿåˆ—æœ‰æ²¡æœ‰ä»»åŠ¡ï¼Œæœ‰å°±è¯»å–æ‰§è¡Œï¼Œä¸€ç›´å¾ªç¯è¯»å–-æ‰§è¡Œçš„æ“ä½œï¼Œå°±å½¢æˆäº†äº‹ä»¶å¾ªç¯ã€‚

![event1](../images/js/event1.png)
![event2](../images/js/event2.png)

* å®šæ—¶å™¨

å®šæ—¶å™¨ä¼šå¼€å¯ä¸€æ¡å®šæ—¶å™¨è§¦å‘çº¿ç¨‹æ¥è§¦å‘è®¡æ—¶ï¼Œå®šæ—¶å™¨ä¼šåœ¨ç­‰å¾…äº†æŒ‡å®šçš„æ—¶é—´åå°†äº‹ä»¶æ”¾å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…è¯»å–åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œã€‚

å®šæ—¶å™¨æŒ‡å®šçš„å»¶æ—¶æ¯«ç§’æ•°å…¶å®å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºå®šæ—¶å™¨åªæ˜¯åœ¨åˆ°äº†æŒ‡å®šçš„æ—¶é—´æ—¶å°†äº‹ä»¶æ”¾å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¿…é¡»è¦ç­‰åˆ°åŒæ­¥çš„ä»»åŠ¡å’Œç°æœ‰çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å…¨éƒ¨æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰ä¼šå»è¯»å–å®šæ—¶å™¨çš„äº‹ä»¶åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œï¼Œä¸­é—´å¯èƒ½ä¼šå­˜åœ¨è€—æ—¶æ¯”è¾ƒä¹…çš„ä»»åŠ¡ï¼Œé‚£ä¹ˆå°±ä¸å¯èƒ½ä¿è¯åœ¨æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œã€‚

* å®ä»»åŠ¡(macro-task)ã€å¾®ä»»åŠ¡(micro-task)

é™¤äº†å¹¿ä¹‰çš„åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ï¼ŒJavaScript å•çº¿ç¨‹ä¸­çš„ä»»åŠ¡å¯ä»¥ç»†åˆ†ä¸ºå®ä»»åŠ¡å’Œå¾®ä»»åŠ¡ã€‚

macro-taskåŒ…æ‹¬ï¼šscript(æ•´ä½“ä»£ç ), setTimeout, setInterval, setImmediate, I/O, UI renderingã€‚

micro-taskåŒ…æ‹¬ï¼šprocess.nextTick, Promises, Object.observe, MutationObserverã€‚

### äº‹ä»¶å¾ªç¯çš„è¿›ç¨‹æ¨¡å‹

* é€‰æ‹©å½“å‰è¦æ‰§è¡Œçš„ä»»åŠ¡é˜Ÿåˆ—ï¼Œé€‰æ‹©ä»»åŠ¡é˜Ÿåˆ—ä¸­æœ€å…ˆè¿›å…¥çš„ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸ºç©ºå³nullï¼Œåˆ™æ‰§è¡Œè·³è½¬åˆ°å¾®ä»»åŠ¡ï¼ˆMicroTaskï¼‰çš„æ‰§è¡Œæ­¥éª¤ã€‚
* å°†äº‹ä»¶å¾ªç¯ä¸­çš„ä»»åŠ¡è®¾ç½®ä¸ºå·²é€‰æ‹©ä»»åŠ¡ã€‚
* æ‰§è¡Œä»»åŠ¡ã€‚
* å°†äº‹ä»¶å¾ªç¯ä¸­å½“å‰è¿è¡Œä»»åŠ¡è®¾ç½®ä¸ºnullã€‚
* å°†å·²ç»è¿è¡Œå®Œæˆçš„ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­åˆ é™¤ã€‚
* microtasksæ­¥éª¤ï¼šè¿›å…¥microtaskæ£€æŸ¥ç‚¹ã€‚
* æ›´æ–°ç•Œé¢æ¸²æŸ“ã€‚
* è¿”å›ç¬¬ä¸€æ­¥ã€‚

### æ‰§è¡Œè¿›å…¥microtaskæ£€æŸ¥ç‚¹æ—¶ï¼Œç”¨æˆ·ä»£ç†ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š

* è®¾ç½®microtaskæ£€æŸ¥ç‚¹æ ‡å¿—ä¸ºtrueã€‚
* å½“äº‹ä»¶å¾ªç¯microtaskæ‰§è¡Œä¸ä¸ºç©ºæ—¶ï¼šé€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥çš„microtaské˜Ÿåˆ—çš„microtaskï¼Œå°†äº‹ä»¶å¾ªç¯çš„microtaskè®¾ç½®ä¸ºå·²é€‰æ‹©çš„microtaskï¼Œè¿è¡Œmicrotaskï¼Œå°†å·²ç»æ‰§è¡Œå®Œæˆçš„microtaskä¸ºnullï¼Œç§»å‡ºmicrotaskä¸­çš„microtaskã€‚
* è®¾ç½®è¿›å…¥microæ£€æŸ¥ç‚¹çš„æ ‡å¿—ä¸ºfalse

æ‰§è¡Œæ ˆåœ¨æ‰§è¡Œå®ŒåŒæ­¥ä»»åŠ¡åï¼ŒæŸ¥çœ‹æ‰§è¡Œæ ˆæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœæ‰§è¡Œæ ˆä¸ºç©ºï¼Œå°±ä¼šå»æ‰§è¡ŒTaskï¼ˆå®ä»»åŠ¡ï¼‰ï¼Œæ¯æ¬¡å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œæ£€æŸ¥å¾®ä»»åŠ¡(microTask)é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œä¼šæŒ‰ç…§å…ˆå…¥å…ˆå‡ºçš„è§„åˆ™å…¨éƒ¨æ‰§è¡Œå®Œå¾®ä»»åŠ¡(microTask)åï¼Œè®¾ç½®å¾®ä»»åŠ¡(microTask)é˜Ÿåˆ—ä¸ºnullï¼Œç„¶åå†æ‰§è¡Œå®ä»»åŠ¡ï¼Œå¦‚æ­¤å¾ªç¯ã€‚

ä¸¾ä¸ªğŸŒ°

```
console.log('script start');

setTimeout(function() {
  console.log('setTimeout');
}, 0);

Promise.resolve().then(function() {
  console.log('promise1');
}).then(function() {
  console.log('promise2');
});

console.log('script end');
```

* ç¬¬ä¸€æ­¥ï¼šæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå°†å®ä»»åŠ¡ï¼ˆTasksï¼‰å’Œå¾®ä»»åŠ¡(Microtasks)åˆ’åˆ†åˆ°å„è‡ªé˜Ÿåˆ—ä¸­ã€‚
* ç¬¬äºŒæ­¥ï¼šæ‰§è¡Œå®ä»»åŠ¡åï¼Œæ£€æµ‹åˆ°å¾®ä»»åŠ¡(Microtasks)é˜Ÿåˆ—ä¸­ä¸ä¸ºç©ºï¼Œæ‰§è¡ŒPromise1ï¼Œæ‰§è¡Œå®ŒæˆPromise1åï¼Œè°ƒç”¨Promise2.thenï¼Œæ”¾å…¥å¾®ä»»åŠ¡(Microtasks)é˜Ÿåˆ—ä¸­ï¼Œå†æ‰§è¡ŒPromise2.thenã€‚
* ç¬¬ä¸‰æ­¥ï¼šå½“å¾®ä»»åŠ¡(Microtasks)é˜Ÿåˆ—ä¸­ä¸ºç©ºæ—¶ï¼Œæ‰§è¡Œå®ä»»åŠ¡ï¼ˆTasksï¼‰ï¼Œæ‰§è¡ŒsetTimeout callbackï¼Œæ‰“å°æ—¥å¿—ã€‚
* ç¬¬å››æ­¥ï¼šæ¸…ç©ºTasksé˜Ÿåˆ—å’ŒJS stackã€‚

å†ä¸¾ä¸ªğŸŒ°

```
console.log('script start')

async function async1() {
  await async2()
  console.log('async1 end')
}
async function async2() {
  console.log('async2 end') 
}
async1()

setTimeout(function() {
  console.log('setTimeout')
}, 0)

new Promise(resolve => {
  console.log('Promise')
  resolve()
})
  .then(function() {
    console.log('promise1')
  })
  .then(function() {
    console.log('promise2')
  })

console.log('script end')
```

è¿™é‡Œéœ€è¦å…ˆç†è§£async/awaitã€‚
async/await åœ¨åº•å±‚è½¬æ¢æˆäº† promise å’Œ then å›è°ƒå‡½æ•°ã€‚
ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ˜¯ promise çš„è¯­æ³•ç³–ã€‚
æ¯æ¬¡æˆ‘ä»¬ä½¿ç”¨ await, è§£é‡Šå™¨éƒ½åˆ›å»ºä¸€ä¸ª promise å¯¹è±¡ï¼Œç„¶åæŠŠå‰©ä¸‹çš„ async å‡½æ•°ä¸­çš„æ“ä½œæ”¾åˆ° then å›è°ƒå‡½æ•°ä¸­ã€‚
async/await çš„å®ç°ï¼Œç¦»ä¸å¼€ Promiseã€‚ä»å­—é¢æ„æ€æ¥ç†è§£ï¼Œasync æ˜¯â€œå¼‚æ­¥â€çš„ç®€å†™ï¼Œè€Œ await æ˜¯ async wait çš„ç®€å†™å¯ä»¥è®¤ä¸ºæ˜¯ç­‰å¾…å¼‚æ­¥æ–¹æ³•æ‰§è¡Œå®Œæˆã€‚

### å…³äº73ä»¥ä¸‹ç‰ˆæœ¬å’Œ73ç‰ˆæœ¬çš„åŒºåˆ«

* åœ¨73ç‰ˆæœ¬ä»¥ä¸‹ï¼Œå…ˆæ‰§è¡Œpromise1å’Œpromise2ï¼Œå†æ‰§è¡Œasync1ã€‚

    * é¦–å…ˆï¼Œä¼ é€’ç»™ await çš„å€¼è¢«åŒ…è£¹åœ¨ä¸€ä¸ª Promise ä¸­ã€‚ç„¶åï¼Œå¤„ç†ç¨‹åºé™„åŠ åˆ°è¿™ä¸ªåŒ…è£…çš„ Promiseï¼Œä»¥ä¾¿åœ¨ Promise å˜ä¸º fulfilled åæ¢å¤è¯¥å‡½æ•°ï¼Œå¹¶ä¸”æš‚åœæ‰§è¡Œå¼‚æ­¥å‡½æ•°ï¼Œä¸€æ—¦ promise å˜ä¸º fulfilledï¼Œæ¢å¤å¼‚æ­¥å‡½æ•°çš„æ‰§è¡Œã€‚
    * æ¯ä¸ª await å¼•æ“å¿…é¡»åˆ›å»ºä¸¤ä¸ªé¢å¤–çš„ Promiseï¼ˆå³ä½¿å³ä¾§å·²ç»æ˜¯ä¸€ä¸ª Promiseï¼‰å¹¶ä¸”å®ƒéœ€è¦è‡³å°‘ä¸‰ä¸ª microtask é˜Ÿåˆ— ticksï¼ˆtickä¸ºç³»ç»Ÿçš„ç›¸å¯¹æ—¶é—´å•ä½ï¼Œä¹Ÿè¢«ç§°ä¸ºç³»ç»Ÿçš„æ—¶åŸºï¼Œæ¥æºäºå®šæ—¶å™¨çš„å‘¨æœŸæ€§ä¸­æ–­ï¼ˆè¾“å‡ºè„‰å†²ï¼‰ï¼Œä¸€æ¬¡ä¸­æ–­è¡¨ç¤ºä¸€ä¸ªtickï¼Œä¹Ÿè¢«ç§°åšä¸€ä¸ªâ€œæ—¶é’Ÿæ»´ç­”â€ã€æ—¶æ ‡ã€‚ï¼‰ã€‚

    ```
    async function f() {
        await p
        console.log('ok')
    }
    ```
    ç®€åŒ–ä¸º
    ```
    function f() {
        return RESOLVE(p).then(() => {
            console.log('ok')
        })
    }
    ```
    * å¦‚æœ RESOLVE(p) å¯¹äº p ä¸º promise ç›´æ¥è¿”å› p çš„è¯ï¼Œé‚£ä¹ˆ pçš„ then æ–¹æ³•å°±ä¼šè¢«é©¬ä¸Šè°ƒç”¨ï¼Œå…¶å›è°ƒå°±ç«‹å³è¿›å…¥ job é˜Ÿåˆ—ã€‚
    * è€Œå¦‚æœ RESOLVE(p) ä¸¥æ ¼æŒ‰ç…§æ ‡å‡†ï¼Œåº”è¯¥æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„ promiseï¼Œå°½ç®¡è¯¥ promiseç¡®å®šä¼š resolve ä¸º pï¼Œä½†è¿™ä¸ªè¿‡ç¨‹æœ¬èº«æ˜¯å¼‚æ­¥çš„ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨è¿›å…¥ job é˜Ÿåˆ—çš„æ˜¯æ–° promise çš„ resolveè¿‡ç¨‹ï¼Œæ‰€ä»¥è¯¥ promise çš„ then ä¸ä¼šè¢«ç«‹å³è°ƒç”¨ï¼Œè€Œè¦ç­‰åˆ°å½“å‰ job é˜Ÿåˆ—æ‰§è¡Œåˆ°å‰è¿° resolve è¿‡ç¨‹æ‰ä¼šè¢«è°ƒç”¨ï¼Œç„¶åå…¶å›è°ƒï¼ˆä¹Ÿå°±æ˜¯ç»§ç»­ await ä¹‹åçš„è¯­å¥ï¼‰æ‰åŠ å…¥ job é˜Ÿåˆ—ï¼Œæ‰€ä»¥æ—¶åºä¸Šå°±æ™šäº†ã€‚

* åœ¨73ç‰ˆæœ¬ï¼Œå…ˆæ‰§è¡Œasync1å†æ‰§è¡Œpromise1å’Œpromise2ã€‚
    * ä½¿ç”¨å¯¹PromiseResolveçš„è°ƒç”¨æ¥æ›´æ”¹awaitçš„è¯­ä¹‰ï¼Œä»¥å‡å°‘åœ¨å…¬å…±awaitPromiseæƒ…å†µä¸‹çš„è½¬æ¢æ¬¡æ•°ã€‚
    * å¦‚æœä¼ é€’ç»™ await çš„å€¼å·²ç»æ˜¯ä¸€ä¸ª Promiseï¼Œé‚£ä¹ˆè¿™ç§ä¼˜åŒ–é¿å…äº†å†æ¬¡åˆ›å»º Promise åŒ…è£…å™¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä»æœ€å°‘ä¸‰ä¸ª microtick åˆ°åªæœ‰ä¸€ä¸ª microtickã€‚

è¯¦æƒ…å‚è€ƒ[è¿™é‡Œ](https://v8.js.cn/blog/fast-async/)

### å¼•ç”³

[https://juejin.im/post/59e85eebf265da430d571f89](https://juejin.im/post/59e85eebf265da430d571f89)

[https://juejin.im/post/59c25c936fb9a00a3f24e114](https://juejin.im/post/59c25c936fb9a00a3f24e114)

[https://segmentfault.com/a/1190000012925872](https://segmentfault.com/a/1190000012925872)



